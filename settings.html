<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Settings - MedConsult</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    /* Loader Overlay */
    #loader-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #0f172a;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 99999;
      transition: opacity 0.5s ease;
    }

    body.light #loader-overlay {
      background: #f8fafc;
    }

    .spinner {
      border: 4px solid #94a3b8;
      border-top: 4px solid var(--primary);
      border-radius: 50%;
      width: 45px;
      height: 45px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body class="dark">
  <div id="loader-overlay">
    <div class="spinner"></div>
  </div>

  <header class="header">
    <h1>MedConsult</h1>
    <a href="dashboard.html">🔙 Back to Dashboard</a>
  </header>

  <div class="dashboard-layout">
    <aside class="sidebar">
      <ul>
        <li><a href="dashboard.html">Dashboard</a></li>
        <li><a href="appointments.html">Appointments</a></li>
        <li><a href="patients.html">Patients</a></li>
        <li><a href="prescriptions.html">Prescriptions</a></li>
        <li><a href="settings.html" class="active">Settings</a></li>
        <li><a href="doctor-profile.html">Profile</a></li>
      </ul>
    </aside>

    <main class="dashboard-content">
      <h2>Settings</h2>

      <div class="settings-panel">
        <h3>Account Settings</h3>

        <label for="name">Full Name</label>
        <input type="text" id="name" placeholder="Dr. Nithish Kumar" />

        <label for="email">Email</label>
        <input type="email" id="email" placeholder="doctor@example.com" />

        <label for="mobile">Mobile Number</label>
        <input type="tel" id="mobile" placeholder="+91 9876543210" />

        <label for="speciality">Speciality</label>
        <input type="text" id="speciality" placeholder="Cardiologist" />

        <label for="location">Location</label>
        <input type="text" id="location" placeholder="Chennai, India" />

        <label for="language">Preferred Language</label>
        <select id="language">
          <option>English</option>
          <option>Hindi</option>
          <option>Tamil</option>
          <option>Telugu</option>
        </select>

        <label for="bio">Short Bio</label>
        <textarea id="bio" rows="4" placeholder="Tell us about your practice..."></textarea>

        <label for="visibility">Profile Visibility</label>
        <select id="visibility">
          <option>Public</option>
          <option>Private</option>
        </select>

        <button class="btn save" onclick="saveSettings()">Save Changes</button>

        <hr />

        <h3>Theme</h3>
        <button id="themeToggle" class="theme-toggle">🌙</button>
      </div>
    </main>
  </div>

  <script>
    const toggle = document.getElementById('themeToggle');
    toggle.addEventListener('click', () => {
      document.body.classList.toggle('dark');
      toggle.textContent = document.body.classList.contains('dark') ? '🌙' : '☀️';
      localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
    });

    if (localStorage.getItem('theme') === 'dark') {
      document.body.classList.add('dark');
    } else {
      document.body.classList.remove('dark');
    }

    window.addEventListener("load", function () {
      const loader = document.getElementById("loader-overlay");
      loader.style.opacity = 0;
      setTimeout(() => loader.style.display = "none", 500);
    });

    function saveSettings() {
      const data = {
        name: document.getElementById("name").value,
        email: document.getElementById("email").value,
        phone: document.getElementById("mobile").value,
        specialization: document.getElementById("speciality").value,
        location: document.getElementById("location").value,
        language: document.getElementById("language").value,
        about: document.getElementById("bio").value,
        visibility: document.getElementById("visibility").value
      };

      fetch(`${API_BASE}/doctor/settings`, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${localStorage.getItem("token")}`
        },
        body: JSON.stringify(data)
      })
      .then(res => res.json())
      .then(data => alert(data.message))
      .catch(err => alert("Failed to save settings"));
    }

    window.addEventListener("load", () => {
      fetch(`${API_BASE}/doctor/settings`, {
        headers: {
          'Authorization': `Bearer ${localStorage.getItem("token")}`
        }
      })
      .then(res => res.json())
      .then(doc => {
        document.getElementById("name").value = doc.name || "";
        document.getElementById("email").value = doc.email || "";
        document.getElementById("mobile").value = doc.phone || "";
        document.getElementById("speciality").value = doc.specialization || "";
        document.getElementById("location").value = doc.location || "";
        document.getElementById("language").value = doc.language || "";
        document.getElementById("bio").value = doc.about || "";
        document.getElementById("visibility").value = doc.visibility || "Public";
      })
      .catch(err => console.error("Failed to load doctor settings:", err));
    });

    function updatePassword() {
  fetch(`${API_BASE}/doctor/change-password`, {
    method: "PUT",
    headers: authHeaders(),
    body: JSON.stringify({
      currentPassword: document.getElementById("currentPwd").value,
      newPassword: document.getElementById("newPwd").value
    })
  })
  .then(res => res.json())
  .then(data => alert(data.message || "Password changed"))
  .catch(() => alert("Error changing password"));

fetch(`${API_BASE}/doctor/profile`, {
      method: "PUT",
      headers: authHeaders(),
      body: JSON.stringify(profileData)
    })
    .then(res => res.json())
    .then(data => {
      alert("Profile updated successfully");
    })
    .catch(() => alert("Error updating profile"));

}


  

  </script>
</body>
</html>
